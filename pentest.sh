#!/bin/bash
# pentest_setup.sh
#
# DESCRIPTION: Creates a structured directory and Markdown file hierarchy 
# for organizing penetration testing findings and reporting based on 
# HTB CPTS professional standards. Generates formal finding documentation,
# attack chain walkthroughs, and executive-grade reporting.
#
# Suitable for: HTB labs, CPTS exam, real-world engagements
#
# USAGE: chmod +x pentest_setup.sh && ./pentest_setup.sh <ProjectName> <ClientName>
# EXAMPLE: ./pentest_setup.sh HTB_LOCK "Inlanefreight Ltd."

# --- Configuration ---
if [ -z "$1" ] || [ -z "$2" ]; then
    echo "Usage: $0 <ProjectName> <ClientName>"
    echo "Example: $0 HTB_LOCK \"Inlanefreight Ltd.\""
    exit 1
fi

PROJECT_NAME="$1"
CLIENT_NAME="$2"
REPORT_FILE="${PROJECT_NAME}/01-Executive-Report.md"
FINDINGS_DIR="${PROJECT_NAME}/02-Technical-Findings"
ATTACK_PATH_DIR="${PROJECT_NAME}/03-Attack-Chains"
EVIDENCE_DIR="${PROJECT_NAME}/04-Evidence"
TOOLS_DIR="${PROJECT_NAME}/05-Tools-Output"
FLAGS_DIR="${PROJECT_NAME}/06-Flags"

# --- Main Functions ---

# Function to create professional executive report (HTB CPTS format)
create_executive_report() {
    echo "--- Creating professional executive report: ${REPORT_FILE} ---"
    cat > "${REPORT_FILE}" << 'REPORT_EOF'
# Penetration Test Report: ${PROJECT_NAME}

**Client**: ${CLIENT_NAME}  
**Assessor**: [Your Name]  
**Report Date**: [Date]  
**Version**: 1.0  
**Classification**: CONFIDENTIAL

---

## 1. Statement of Confidentiality

The contents of this document have been developed for authorized penetration testing purposes only. This report and its contents are strictly confidential and proprietary. This information is to be used only in the performance of its intended use. 

This document may not be released to another vendor, business partner, or contractor without prior written consent from the authorized party. Additionally, no portion of this document may be communicated, reproduced, copied, or distributed without the prior consent of the authorized assessor.

The contents of this document do not constitute legal advice. This assessment is conducted under agreed-upon rules of engagement and scope.

---

## 2. Engagement Contacts

### Client Contacts

| Role | Name | Title | Email | Phone |
|------|------|-------|-------|-------|
| Primary POC | [Name] | [Title] | [Email] | [Phone] |
| Technical POC | [Name] | [Title] | [Email] | [Phone] |
| Approver | [Name] | [Title] | [Email] | [Phone] |

### Assessor Information

| Role | Name | Title | Email | Phone |
|------|------|-------|-------|-------|
| Lead Assessor | [Your Name] | Penetration Tester | [Email] | [Phone] |

---

## 3. Executive Summary

### 3.1 Overview

${CLIENT_NAME} contracted [Assessor Name] to perform a comprehensive Network Penetration Test of the organization's externally and internally facing infrastructure. The engagement was conducted under a **Black Box** methodology, simulating a real-world attacker with no prior knowledge of the environment.

**Assessment Type**: Black Box - External and Internal Network Penetration Test  
**Testing Model**: Non-evasive (comprehensive vulnerability discovery focus)  
**Duration**: [Start Date] to [End Date] ([X] business days)  
**Engagement Scope**: External perimeter, internal networks, Active Directory domain(s)

### 3.2 High-Level Risk Assessment

| Severity | Count | CVSS Range | Business Impact |
|----------|-------|-----------|-----------------|
| **Critical** | [#] | 9.0 - 10.0 | Immediate threat to operations |
| **High** | [#] | 7.0 - 8.9 | Significant security risk |
| **Medium** | [#] | 4.0 - 6.9 | Moderate risk requiring attention |
| **Low** | [#] | 0.1 - 3.9 | Minimal risk, monitoring recommended |
| **Informational** | [#] | 0.0 | Recommendations for hardening |

### 3.3 Key Findings Summary

**Most Critical Vulnerabilities**:
1. [Vulnerability Title] - CVSS 9.x - [Impact Summary]
2. [Vulnerability Title] - CVSS 8.x - [Impact Summary]
3. [Vulnerability Title] - CVSS 7.x - [Impact Summary]

### 3.4 Overall Security Posture

**Assessment**: [Poor / Fair / Adequate / Good / Excellent]

[1-2 paragraph summary of the organization's security posture, including:]
- Overall risk level
- Primary attack vectors
- Effectiveness of existing controls
- Time to compromise
- Scope of potential attacker access

### 3.5 Primary Findings at a Glance

- **Systems Compromised**: [#] external + [#] internal = [#] total
- **Time to Initial Compromise**: [X] hours from engagement start
- **Time to Domain Admin**: [X] hours from initial access
- **Users Potentially Affected**: [#]
- **Sensitive Data at Risk**: [Categories: PII, Financial, IP, Source Code, etc.]
- **Detection**: [Yes/No] - Security controls detected exploitation attempts

### 3.6 Immediate Recommendations

1. **CRITICAL - Immediate Actions Required**:
   - [Finding #X]: [Specific remediation action]
   - [Finding #X]: [Specific remediation action]
   - Reset all domain user passwords
   - Revoke compromised credentials

2. **HIGH - Address Within 30 Days**:
   - [Finding #X]: [Specific remediation action]
   - [Finding #X]: [Specific remediation action]

3. **MEDIUM - Plan for Next 90 Days**:
   - Implement network segmentation
   - Deploy EDR/XDR solutions
   - Conduct AD hardening assessment

---

## 4. Scope and Methodology

### 4.1 Scope Definition

#### In Scope Assets

| Asset Type | Target(s) | Description | Notes |
|-----------|-----------|-------------|-------|
| **External IP(s)** | [IP/CIDR] | Public-facing servers | Production environment |
| **Internal Network(s)** | [CIDR Range] | Internal subnet | DMZ, Corp, Lab |
| **Active Directory Domain** | [Domain Name] | Primary AD domain | Forest root |
| **Web Applications** | [App Names] | Public-facing web apps | [Notes] |
| **Other Systems** | [Details] | VPN, Mail, etc. | [Notes] |

#### Out of Scope

- Third-party vendors and SaaS providers
- Physical security assessments
- Social engineering (without explicit authorization)
- Denial-of-Service (DoS/DDoS) attacks
- Destruction of data or systems
- Access to production customer data (unless authorized)

### 4.2 Testing Methodology

This assessment followed industry-standard penetration testing frameworks:

- **NIST Cybersecurity Framework** - Overall assessment approach
- **OWASP Testing Guide v4.2** - Web application testing
- **PTES (Penetration Testing Execution Standard)** - Attack chain execution
- **MITRE ATT&CK Framework** - Adversary tactics and techniques reference

**Assessment Phases**:
1. Reconnaissance & Footprinting (Passive/Active OSINT)
2. Scanning & Enumeration (Network/Service discovery)
3. Vulnerability Analysis (Assessment of discovered weaknesses)
4. Exploitation (Proof-of-concept for critical/high findings)
5. Post-Exploitation (Lateral movement, privilege escalation)
6. Reporting & Recommendations (Documentation and remediation planning)

### 4.3 Rules of Engagement

- [Specify any custom RoE: Time windows, systems to avoid, etc.]
- Assessment conducted outside business hours where possible
- No production data exfiltration (evidence-only collection)
- Persistence mechanisms documented and explained before deployment
- Post-engagement cleanup performed on all compromised systems

---

## 5. Assessment Summary and Findings Overview

### 5.1 Findings Distribution

[Insert chart or visual showing vulnerability distribution]

### 5.2 Summary of All Findings

| # | Finding ID | Title | Severity | CVSS | Affected Host(s) | Status |
|---|-----------|-------|----------|------|-----------------|--------|
| 1 | FIN-001 | [Title] | Critical | 9.x | [Host] | Exploited |
| 2 | FIN-002 | [Title] | High | 8.x | [Host] | Exploited |
| 3 | FIN-003 | [Title] | High | 7.x | [Host] | Documented |
| [more...] | | | | | | |

---

## 6. Detailed Attack Chain and Compromise Walkthrough

### 6.1 Attack Path Overview

The following documents the primary attack chain from initial external reconnaissance through full domain compromise. This represents the "path of least resistance" identified during testing; other attack paths may also exist.

**Total Attack Chain Duration**: [X] hours

### 6.2 Phase 1: External Reconnaissance and Initial Access

**Objective**: Identify and exploit externally accessible vulnerability to gain initial foothold

**Key Vulnerabilities Used**:
- FIN-001: [Vulnerability Name]
- FIN-002: [Vulnerability Name]

**Timeline**: [Start Time] → [End Time]

**Steps**:
1. [High-level step 1]
2. [High-level step 2]
3. [High-level step 3]

**Result**: Initial access gained as [User/System] on [Host] with [Access Level]

**Detailed Steps** (See: `/03-Attack-Chains/Phase-1-External-Access.md`)

---

### 6.3 Phase 2: Internal Network Foothold and Persistence

**Objective**: Establish stable, persistent access within internal network

**Key Vulnerabilities Used**:
- FIN-003: [Vulnerability Name]
- FIN-004: [Vulnerability Name]

**Timeline**: [Start Time] → [End Time]

**Steps**:
1. [High-level step 1]
2. [High-level step 2]
3. [High-level step 3]

**Result**: Persistence established; credentials obtained

**Detailed Steps** (See: `/03-Attack-Chains/Phase-2-Internal-Foothold.md`)

---

### 6.4 Phase 3: Privilege Escalation (Local)

**Objective**: Escalate from initial user to administrative/SYSTEM privileges

**Key Vulnerabilities Used**:
- FIN-005: [Vulnerability Name]
- FIN-006: [Vulnerability Name]

**Timeline**: [Start Time] → [End Time]

**Result**: SYSTEM/Admin privileges obtained on [Host]

**Detailed Steps** (See: `/03-Attack-Chains/Phase-3-Privilege-Escalation.md`)

---

### 6.5 Phase 4: Lateral Movement and Domain Reconnaissance

**Objective**: Move to additional hosts and compromise domain infrastructure

**Key Vulnerabilities Used**:
- FIN-007: [Vulnerability Name]
- FIN-008: [Vulnerability Name]

**Timeline**: [Start Time] → [End Time]

**Result**: Access obtained on [#] additional systems; domain recon completed

**Detailed Steps** (See: `/03-Attack-Chains/Phase-4-Lateral-Movement.md`)

---

### 6.6 Phase 5: Domain Compromise

**Objective**: Achieve Domain Admin/DC access and full domain compromise

**Key Vulnerabilities Used**:
- FIN-009: [Vulnerability Name]
- FIN-010: [Vulnerability Name]

**Timeline**: [Start Time] → [End Time]

**Result**: Full domain compromise; Domain Admin credentials obtained

**Detailed Steps** (See: `/03-Attack-Chains/Phase-5-Domain-Compromise.md`)

---

## 7. Technical Findings Details

### Finding Organization

Each finding below contains:
- **Finding ID & Title**
- **Severity Rating (CVSS 3.1 Score)**
- **CWE Reference**
- **Affected System(s)**
- **Description** - Technical explanation
- **Root Cause** - Why vulnerability exists
- **Impact** - Confidentiality/Integrity/Availability
- **Proof of Concept** - Reproduction steps
- **Evidence** - Screenshots, output, logs
- **Remediation** - Specific corrective actions
- **References** - CVE, CVSS details, remediation links

---

### FINDING-001: [Vulnerability Title]

**Severity**: [Critical/High/Medium/Low] | **CVSS 3.1**: [Score] (Base Vector: [CVSS Vector])  
**CWE**: [CWE-XXX]  
**Affected Host(s)**: [IP/Hostname]

#### Description

[2-3 paragraph technical description of the vulnerability, including:]
- What was found
- Why it's exploitable
- Current configuration that enables the issue

#### Root Cause

[Explanation of why this vulnerability exists:]
- Misconfiguration
- Missing security control
- Outdated software
- Development artifact left in production

#### Impact

**Confidentiality**: [High/Medium/Low]  
**Integrity**: [High/Medium/Low]  
**Availability**: [High/Medium/Low]

**Business Impact**:
[Description of how this vulnerability affects business operations, data protection, compliance, etc.]

#### Proof of Concept

```bash
[Exact commands/steps to reproduce]
[Include command output showing exploitation]
```

#### Evidence

- **Screenshot**: [Reference to evidence file]
- **Command Output**: [Reference to output file]
- **Logs**: [Reference to log file]

#### Remediation

**Immediate Actions**:
1. [Specific step 1]
2. [Specific step 2]

**Short-Term (30 days)**:
- [Action with responsible party]
- [Timeline]

**Long-Term (Strategic)**:
- [Long-term hardening]

**Validation**:
- How to verify remediation is effective
- Testing steps

#### References

- https://cve.mitre.org/cgi-bin/cvename.cgi?name=[CVE]
- https://nvd.nist.gov/vuln/detail/[CVE]
- [Remediation links]

---

### [Repeat for FIN-002, FIN-003, etc.]

---

## 8. Remediation Summary and Action Plan

### 8.1 Short-Term Remediation (Immediate - Next 30 Days)

| Priority | Finding ID | Issue | Remediation Action | Owner | Target Date | Success Criteria |
|----------|-----------|-------|-------------------|-------|-------------|-----------------|
| P0 | FIN-001 | [Title] | [Specific action] | [Owner] | [Date] | [How to verify] |
| P0 | FIN-002 | [Title] | [Specific action] | [Owner] | [Date] | [How to verify] |
| P1 | FIN-003 | [Title] | [Specific action] | [Owner] | [Date] | [How to verify] |

### 8.2 Medium-Term Remediation (30-90 Days)

| Finding ID | Issue | Remediation Action | Owner | Target Date | Success Criteria |
|-----------|-------|-------------------|-------|-------------|-----------------|
| FIN-004 | [Title] | [Specific action] | [Owner] | [Date] | [How to verify] |

### 8.3 Long-Term Strategic Initiatives (90+ Days)

| Initiative | Description | Owner | Timeline | Success Metrics |
|-----------|-------------|-------|----------|-----------------|
| AD Hardening | Implement T1 Tier model | [Owner] | [Timeline] | [Metrics] |
| Network Segmentation | Deploy zero-trust architecture | [Owner] | [Timeline] | [Metrics] |

---

## 9. Appendices

### A.1 Finding Severities and CVSS Scoring

| Severity | CVSS Score | Definition |
|----------|-----------|-----------|
| **Critical** | 9.0 - 10.0 | Immediate exploitation risk; likely to lead to full system compromise |
| **High** | 7.0 - 8.9 | High exploitation potential; significant impact to confidentiality, integrity, or availability |
| **Medium** | 4.0 - 6.9 | Moderate exploitation potential; notable security impact |
| **Low** | 0.1 - 3.9 | Low exploitation potential; minimal security impact |
| **Informational** | 0.0 | Observations and recommendations; not a security vulnerability |

### A.2 Host and Service Discovery

| IP Address | Hostname | Port | Service | Version | Status |
|-----------|----------|------|---------|---------|--------|
| [IP] | [Host] | [Port] | [Service] | [Ver] | Exploited/Documented |

### A.3 Subdomain and Virtual Host Discovery

| URL/Subdomain | Type | IP Address | Technology | Notes |
|---------------|------|-----------|-----------|-------|
| [Subdomain] | Subdomain/Vhost | [IP] | [Tech] | [Notes] |

### A.4 Exploited Hosts Summary

| Hostname | IP Address | OS | Initial Access Method | Final Access Level | Persistence Method |
|----------|-----------|-----|----------------------|-------------------|-------------------|
| [Host] | [IP] | [OS] | [Method] | [Admin/System/User] | [Method] |

### A.5 Compromised User Accounts

| Username | Domain | Account Type | Compromise Method | Credentials Obtained | Status |
|----------|--------|--------------|-------------------|----------------------|--------|
| [User] | [Domain] | User/Service/Admin | [Method] | Password/Hash/Ticket | Active/Disabled |

### A.6 Post-Engagement Cleanup Log

| System | Host | Change Made | Cleaned Up | Verified |
|--------|------|------------|-----------|----------|
| [Host] | [IP] | [Change] | [ ] Yes / [ ] No | [ ] Verified |

### A.7 Flags Captured (HTB Lab Reference)

| # | Flag Type | Host | Flag Value | Location | Method Used | Captured |
|---|-----------|------|-----------|----------|------------|----------|
| 1 | user.txt | [Host] | [MD5] | /home/user/ | [Method] | ✓ |
| 2 | root.txt | [Host] | [MD5] | /root/ | [Method] | ✓ |

### A.8 Tools and Techniques Used

| Phase | Tool | Version | Purpose | Notes |
|-------|------|---------|---------|-------|
| Recon | [Tool] | [Ver] | [Purpose] | [Notes] |
| Scanning | nmap | 7.x | Network discovery | Full TCP/UDP scan |
| Exploitation | [Tool] | [Ver] | [Purpose] | [Notes] |
| Post-Exploitation | mimikatz | 2.2.0 | Credential dumping | LSA extraction |

### A.9 References and Standards

**Frameworks & Standards**:
- OWASP Top 10 Web Application Security Risks
- NIST Cybersecurity Framework
- PTES (Penetration Testing Execution Standard)
- CWE/CVSS Scoring Documentation
- MITRE ATT&CK Framework

**Remediation Resources**:
- [Client-specific security standards]
- [Internal security policies]
- [Compliance requirements: GDPR, HIPAA, PCI-DSS, etc.]

---

## 10. Report Sign-Off

### Prepared By

**Name**: [Assessor Name]  
**Title**: Penetration Tester / Security Consultant  
**Date**: [Date]  
**Signature**: ____________________________

### Reviewed By (Quality Assurance)

**Name**: [Reviewer Name]  
**Title**: [Title]  
**Date**: [Date]  
**Signature**: ____________________________

### Accepted By (Client)

**Name**: [Client Representative]  
**Title**: [Title]  
**Date**: [Date]  
**Signature**: ____________________________

---

*End of Report*

**This report was prepared by [Assessor Name] on [Date]**  
**CONFIDENTIAL - For Authorized Use Only**

REPORT_EOF
    sed -i "s|\${PROJECT_NAME}|${PROJECT_NAME}|g" "${REPORT_FILE}"
    sed -i "s|\${CLIENT_NAME}|${CLIENT_NAME}|g" "${REPORT_FILE}"
    echo "  Created: ${REPORT_FILE}"
}

# Function to create directory structure
create_directories() {
    echo "--- Creating professional project structure ---"
    mkdir -p "${PROJECT_NAME}"
    mkdir -p "${FINDINGS_DIR}"
    mkdir -p "${ATTACK_PATH_DIR}"
    mkdir -p "${EVIDENCE_DIR}/screenshots"
    mkdir -p "${EVIDENCE_DIR}/command-output"
    mkdir -p "${EVIDENCE_DIR}/logs"
    mkdir -p "${TOOLS_DIR}"
    mkdir -p "${FLAGS_DIR}"
    echo "Directory structure created successfully."
}

# Function to create formal finding template
create_finding_template() {
    echo "--- Creating formal finding template ---"
    
    cat > "${FINDINGS_DIR}/TEMPLATE-Finding-Format.md" << 'FINDING_EOF'
# FINDING-XXX: [Vulnerability Title]

**Severity**: [Critical/High/Medium/Low] | **CVSS 3.1**: [Score]  
**CWE**: [CWE-XXX] - [CWE Title]  
**Affected Host(s)**: [IP Address / Hostname]  
**Discovery Date**: [Date]  
**Status**: [Open / Remediated / In Progress]

---

## Description

[2-3 paragraph technical description]

### What Was Found

[Specific vulnerability details]

### Why It's Exploitable

[Why this vulnerability can be weaponized]

### Current Configuration

[How the system is currently misconfigured]

---

## Root Cause Analysis

[Why does this vulnerability exist?]

- [ ] Misconfiguration
- [ ] Outdated software
- [ ] Missing security control
- [ ] Development artifact in production
- [ ] Inadequate input validation
- [ ] Weak permission settings

**Root Cause**: [Specific cause explanation]

---

## Impact Assessment

### Confidentiality
- **Rating**: [High/Medium/Low]
- **Details**: [What data could be exposed?]

### Integrity
- **Rating**: [High/Medium/Low]
- **Details**: [What data could be modified?]

### Availability
- **Rating**: [High/Medium/Low]
- **Details**: [How could services be disrupted?]

### Business Impact

[1 paragraph explaining business consequences]
- Data exposure scope
- Compliance implications
- Operational disruption
- Financial risk

---

## Proof of Concept

### Prerequisites

```bash
# What's needed before exploitation
- Access to [Service]
- Credentials: [If applicable]
- Tools: [List tools required]
```

### Exploitation Steps

```bash
# Step 1: [Description]
[Command 1]
[Output]

# Step 2: [Description]
[Command 2]
[Output]

# Step 3: [Description]
[Command 3]
[Output]
```

### Expected Result

[Description of successful exploitation]

---

## Evidence Collected

### Screenshots

- **File**: [Filename] - [Description]
- **File**: [Filename] - [Description]

### Command Output

- **File**: [Filename] - [Description]
- **File**: [Filename] - [Description]

### Logs

- **File**: [Filename] - [Description]

---

## Remediation Plan

### Immediate Actions (This Week)

1. **Action**: [Specific remediation step]
   - **Owner**: [Responsible party]
   - **Timeline**: [Target date]
   - **Validation**: [How to verify]

2. **Action**: [Specific remediation step]
   - **Owner**: [Responsible party]
   - **Timeline**: [Target date]
   - **Validation**: [How to verify]

### Short-Term Fixes (30 Days)

1. **Action**: [Specific remediation step]
   - **Implementation Steps**:
     ```bash
     [Specific commands/configuration changes]
     ```
   - **Owner**: [Responsible party]
   - **Timeline**: [Target date]
   - **Validation**: [How to verify]

### Long-Term Hardening (90+ Days)

1. **Strategic Initiative**: [Long-term fix]
   - **Description**: [Detailed description]
   - **Owner**: [Responsible party]
   - **Timeline**: [Target date]
   - **Success Metrics**: [How to measure effectiveness]

### Configuration Example

```bash
# Before (Vulnerable)
[Vulnerable configuration]

# After (Remediated)
[Secure configuration]
```

---

## Remediation Validation Checklist

- [ ] Configuration change implemented
- [ ] Change tested in non-production environment
- [ ] Vulnerability re-tested post-remediation
- [ ] Logs reviewed for successful remediation
- [ ] Documentation updated
- [ ] Team informed of changes

---

## References

- **CVE**: [CVE-XXXX-XXXXX](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-XXXX-XXXXX)
- **CWE**: [CWE-XXX](https://cwe.mitre.org/data/definitions/XXX.html)
- **CVSS Calculator**: https://www.first.org/cvss/calculator/3.1
- **NIST Reference**: [Link to NIST guidance]
- **Remediation Guide**: [Link to vendor/community remediation]

---

## Related Findings

- FIN-XXX: [Related finding]
- FIN-XXX: [Related finding]

---

**Last Updated**: [Date]  
**Reviewed By**: [Name]

FINDING_EOF
    echo "  Created: Finding template"
}

# Function to create attack phase templates
create_attack_chain_templates() {
    echo "--- Creating attack chain phase templates ---"
    
    # Phase 1: External Access
    cat > "${ATTACK_PATH_DIR}/Phase-1-External-Access.md" << 'PHASE1_EOF'
# Phase 1: External Reconnaissance and Initial Access

**Duration**: [Start Time] → [End Time] ([X] hours)  
**Key Finding IDs**: FIN-001, FIN-002, FIN-003  
**Result**: Initial shell access as [User] on [Host]

---

## Objective

Identify and exploit externally accessible vulnerabilities to gain initial foothold into the target network.

---

## High-Level Steps

1. Reconnaissance and OSINT
2. Service enumeration and fingerprinting
3. Vulnerability identification
4. Exploitation
5. Initial access confirmation

---

## Detailed Walkthrough

### Step 1: Reconnaissance

**Tools Used**: nmap, dig, wfuzz, Shodan

```bash
# DNS enumeration
dig @target.com target.com
dig axfr target.com @target.com

# Subdomain discovery
wfuzz -w subdomains.txt -u http://target.com/FUZZ

# Port scanning
nmap -sV -sC -p- target.com
```

**Findings**:
- [Finding 1]
- [Finding 2]

---

### Step 2: Service Enumeration

**Services Identified**:
- [Service 1] on [Port]
- [Service 2] on [Port]

**Versions Identified**:
- [Software] v[Version] → Vulnerable to [CVE]

---

### Step 3: Exploitation

**Vulnerability Used**: FIN-001 - [Vulnerability Name]

```bash
# Exploitation command
[Command]

# Result
[Output showing successful exploitation]
```

---

### Step 4: Initial Access Verification

```bash
whoami
id
pwd
hostname
```

**Access Level Achieved**: [User/System/Admin] on [Host]

---

## Artifacts Created

- Shell type: [bash/cmd/powershell]
- Location: [Path/method]
- Persistence: [Method used]

---

## Next Phase

[Link to Phase 2]

PHASE1_EOF

    cat > "${ATTACK_PATH_DIR}/Phase-2-Internal-Foothold.md" << 'PHASE2_EOF'
# Phase 2: Internal Network Foothold and Persistence

**Duration**: [Start Time] → [End Time] ([X] hours)  
**Key Finding IDs**: FIN-004, FIN-005  
**Result**: Persistent access established; internal network access gained

---

## Objective

Establish stable, persistent access within the internal network and gather credential intelligence.

---

## High-Level Steps

1. Local enumeration and privilege elevation reconnaissance
2. Persistence mechanism deployment
3. Internal network scanning
4. Credential harvesting
5. Persistence validation

---

## Detailed Walkthrough

### Step 1: System Enumeration

```bash
# Enumerate system information
systeminfo / uname -a

# Check user context
whoami
id

# List running processes
tasklist / ps aux

# Check network interfaces
ipconfig /all / ifconfig -a
```

---

### Step 2: Persistence Deployment

**Method**: [Scheduled task / Cron job / SSH key / Backdoor account]

```bash
# Deploy persistence
[Persistence commands]
```

---

### Step 3: Credential Discovery

```bash
# Search for credentials
grep -r "password" /etc/
cat ~/.bash_history
```

**Credentials Found**:
- Username: [User]
- Password: [Pass]
- Location: [Where found]

---

## Results

- Persistence Method: [Method]
- Credentials Obtained: [#]
- Internal access confirmed: [Yes/No]

---

## Next Phase

[Link to Phase 3]

PHASE2_EOF

    cat > "${ATTACK_PATH_DIR}/Phase-3-Privilege-Escalation.md" << 'PHASE3_EOF'
# Phase 3: Local Privilege Escalation

**Duration**: [Start Time] → [End Time] ([X] hours)  
**Key Finding IDs**: FIN-006, FIN-007  
**Result**: SYSTEM/Root privileges obtained on [Host]

---

## Objective

Escalate from current user privileges to administrative/SYSTEM level.

---

## Detailed Walkthrough

### Vulnerability Exploited

**Finding**: FIN-006 - [Privilege Escalation Vulnerability]  
**CVSS**: [Score]

### Exploitation

```bash
# Privilege escalation command
[Command]

# Verification
whoami
id
```

---

## Results

- Initial User: [User]
- Final User: [SYSTEM/Root]
- Access Level: Admin/System

---

## Next Phase

[Link to Phase 4]

PHASE3_EOF

    cat > "${ATTACK_PATH_DIR}/Phase-4-Lateral-Movement.md" << 'PHASE4_EOF'
# Phase 4: Lateral Movement and Domain Reconnaissance

**Duration**: [Start Time] → [End Time] ([X] hours)  
**Key Finding IDs**: FIN-008, FIN-009, FIN-010  
**Result**: Access established on [#] additional systems; domain intelligence gathered

---

## Objective

Move laterally across the network to critical systems and gather domain reconnaissance.

---

## Target Systems Identified

| Host | IP Address | OS | Purpose | Access Method |
|------|-----------|-----|---------|---------------|
| [Host] | [IP] | [OS] | [Purpose] | [Method] |

---

## Lateral Movement Execution

### Movement 1: [Host1] → [Host2]

**Method**: Pass-the-Hash / SSH Key / RDP with stolen credentials

```bash
# Lateral movement command
[Command]

# Verification
[Output showing successful access]
```

---

## Domain Reconnaissance

```bash
# Domain enumeration
net user /domain
net group /domain
Get-DomainUser
```

**Intelligence Gathered**:
- Domain Name: [Domain]
- Domain Controllers: [DC1], [DC2]
- Users Found: [#]
- Service Accounts: [SPN accounts]

---

## Results

- Systems Compromised: [#]
- Credentials Obtained: [#]
- Domain intel gathered: Yes

---

## Next Phase

[Link to Phase 5]

PHASE4_EOF

    cat > "${ATTACK_PATH_DIR}/Phase-5-Domain-Compromise.md" << 'PHASE5_EOF'
# Phase 5: Domain Compromise and Full Access

**Duration**: [Start Time] → [End Time] ([X] hours)  
**Key Finding IDs**: FIN-011, FIN-012, FIN-013  
**Result**: Full domain compromise; Domain Admin/DC access achieved

---

## Objective

Achieve Domain Admin or Domain Controller access and demonstrate full domain compromise.

---

## Detailed Walkthrough

### Attack Vector Used

**Finding**: FIN-011 - [Domain Compromise Vulnerability]  
**CVSS**: [Score]

### Exploitation Steps

```bash
# Kerberoasting / DCSync / Trust exploitation
[Commands]

# Hash extraction
[Commands and output]
```

---

## Domain Compromise Results

| Metric | Value |
|--------|-------|
| Domain Name | [Domain] |
| Domain Admin Access | Yes / No |
| Domain Controller Access | Yes / No |
| Credentials Dumped | [#] users |
| KRBTGT Hash | [Obtained/Not Obtained] |

---

## Impact Demonstration

- Full domain credential access
- Ability to access all domain-joined systems
- Potential for persistent access (Golden Ticket, etc.)
- Access to sensitive domain data

---

## Aftermath

This phase demonstrates complete network compromise. All findings in previous phases, combined with this attack, show the attacker achieved full administrative control of the environment.

PHASE5_EOF

    echo "  Created: Attack chain phase templates"
}

# Function to create evidence organization structure
create_evidence_structure() {
    echo "--- Creating evidence organization files ---"
    
    cat > "${EVIDENCE_DIR}/README.md" << 'EVIDENCE_EOF'
# Evidence and Proof-of-Concept Collection

This directory contains organized evidence of vulnerabilities exploited during the penetration test.

## Organization

### /screenshots
Store all proof-of-concept screenshots here.

**Naming Convention**: `FINDING-XXX-Description-YYYYMMDD.png`

**Example**: `FINDING-001-Anonymous-FTP-Access-20250101.png`

### /command-output
Store raw command output demonstrating vulnerabilities.

**Naming Convention**: `FINDING-XXX-CommandOutput-YYYYMMDD.txt`

**Example**: `FINDING-001-FTP-Session-20250101.txt`

### /logs
Store system logs, access logs, exploitation logs.

**Naming Convention**: `FINDING-XXX-Log-Type-YYYYMMDD.log`

**Example**: `FINDING-001-Apache-Access-Log-20250101.log`

## Evidence Indexing

| Finding ID | Evidence Type | File | Date | Description |
|-----------|--------------|------|------|-------------|
| FIN-001 | Screenshot | FINDING-001-Screenshot.png | [Date] | Anonymous FTP access |
| FIN-001 | Command Output | FINDING-001-Output.txt | [Date] | FTP session transcript |

## Important Notes

- All evidence should be indexed in the main report
- Screenshots should clearly show vulnerability exploitation
- Command output should include full session context
- Maintain chain of custody for all evidence
- Do not include sensitive data (customer PII) in evidence

EVIDENCE_EOF

    cat > "${TOOLS_DIR}/README.md" << 'TOOLS_EOF'
# Tools Output Directory

Store raw output from reconnaissance, scanning, and analysis tools.

## Organization by Tool

### /nmap
Network scanning results (host discovery, port scans, service enumeration)

**Naming Convention**: `nmap-Target-YYYYMMDD.xml` or `nmap-Target-YYYYMMDD.txt`

### /gobuster
Directory and file brute-forcing results

**Naming Convention**: `gobuster-Target-YYYYMMDD.txt`

### /nikto
Web server scanning results

**Naming Convention**: `nikto-Target-YYYYMMDD.txt`

### /wpscan
WordPress security scanning

**Naming Convention**: `wpscan-Target-YYYYMMDD.txt`

### /custom
Other tool outputs

## Tools Inventory

| Tool | Version | Purpose | Installation |
|------|---------|---------|--------------|
| nmap | 7.x | Network scanning | apt install nmap |
| gobuster | 3.x | Directory brute-force | go install github.com/OJ/gobuster@latest |
| wfuzz | 3.x | Parameter fuzzing | apt install wfuzz |
| sqlmap | 1.x | SQLi detection | apt install sqlmap |
| burp | Pro/CE | Web proxy | Download from portswigger.com |
| mimikatz | 2.2 | Windows credential dumping | github.com/gentilkiwi/mimikatz |
| hashcat | 6.x | Password cracking | apt install hashcat |
| metasploit | Latest | Exploitation framework | apt install metasploit-framework |

TOOLS_EOF

    cat > "${FLAGS_DIR}/README.md" << 'FLAGS_EOF'
# Flags Directory (HTB Lab Reference)

Track and organize captured flags for HTB labs and similar challenges.

## Flag Tracking Table

| # | Flag Type | Host/System | Flag Value | Location | Method | Date Captured | Verified |
|---|-----------|------------|-----------|----------|--------|--------------|----------|
| 1 | user.txt | [Hostname] | [MD5 Hash] | /home/user/ | [How obtained] | [Date] | ✓ |
| 2 | root.txt | [Hostname] | [MD5 Hash] | /root/ | [How obtained] | [Date] | ✓ |
| 3 | [Type] | [Host] | [Flag] | [Location] | [Method] | [Date] | [ ] |

## Flag Capture Commands

```bash
# Linux user flag
cat /home/user/user.txt

# Linux root flag
cat /root/root.txt

# Windows user flag
type C:\Users\[User]\Desktop\user.txt

# Windows admin flag
type C:\Users\Administrator\Desktop\root.txt
```

## Statistics

- **Total Flags Expected**: [#]
- **Flags Captured**: [#]
- **Capture Rate**: [#]%
- **Estimated Points**: [#]

## Notes

- [System] flags captured via [method]
- [System] flags captured via [method]
- Outstanding flags: [Details]

FLAGS_EOF

    echo "  Created: Evidence structure and organization files"
}

# Function to create credentials tracking
create_credentials_tracking() {
    echo "--- Creating credentials tracking template ---"
    
    cat > "${PROJECT_NAME}/Credentials-Summary.md" << 'CREDS_EOF'
# Credentials Summary

Comprehensive tracking of all credentials discovered and compromised during the assessment.

## Active Directory Credentials

### Domain Admin Accounts

| Username | Domain | Password/Hash | Method Obtained | Status | Exploited For |
|----------|--------|---------------|-----------------|--------|---------------|
| [User] | [Domain] | [Cred] | Kerberoasting | [Active/Disabled] | Domain compromise |

### Service Accounts (SPN Accounts)

| Username | Domain | Service | Password/Hash | Method | Status |
|----------|--------|---------|---------------|--------|--------|
| [User] | [Domain] | [Service] | [Cred] | [Method] | [Status] |

### User Accounts

| Username | Domain | Password/Hash | Source | Status |
|----------|--------|---------------|--------|--------|
| [User] | [Domain] | [Cred] | [Where found] | [Status] |

---

## Local System Credentials

| Host | Username | Password | Location Found | Access Level |
|------|----------|----------|-----------------|--------------|
| [Host] | [User] | [Pass] | [Config file/env/etc] | [Admin/User] |

---

## Application Credentials

| Application | Username | Password | Location | Severity |
|-------------|----------|----------|----------|----------|
| [App] | [User] | [Pass] | [Location] | [High/Med/Low] |

---

## API Keys and Tokens

| Service | Key/Token | Location | Scope | Status |
|---------|-----------|----------|-------|--------|
| [Service] | [Key] | [Location] | [Scope] | [Active/Revoked] |

---

## Hashes Extracted

### SAM Database

| Account | NTLM Hash | Status |
|---------|-----------|--------|
| Administrator | [Hash] | [Cracked/Not Cracked] |
| [User] | [Hash] | [Cracked/Not Cracked] |

### NTDS.DIT (Domain)

| Account | NTLM Hash | Status |
|---------|-----------|--------|
| krbtgt | [Hash] | Domain compromise indicator |
| Administrator | [Hash] | [Cracked/Not Cracked] |

---

## Kerberos Tickets

| Account | Ticket Type | Obtained | Status |
|---------|------------|----------|--------|
| [Account] | TGT/TGS | [Date] | [Usable] |

---

## Credential Assessment

**Total Unique Credentials**: [#]
**Cracked/Usable**: [#]
**High-Risk Accounts Compromised**: [#]
**Service Accounts Compromised**: [#]

**Risk Level**: [Critical/High/Medium]

---

## Remediation Required

- [ ] Force password reset for all users
- [ ] Reset service account passwords
- [ ] Revoke API keys and tokens
- [ ] Monitor for credential reuse
- [ ] Audit privileged account activity

CREDS_EOF

    echo "  Created: Credentials tracking template"
}

# Function to create quick reference checklist
create_quick_reference() {
    echo "--- Creating quick reference checklist ---"
    
    cat > "${PROJECT_NAME}/00-QUICK-START.md" << 'QUICKSTART_EOF'
# Quick Start Guide

## During Assessment

### Daily Documentation

**At End of Each Day**:

1. [ ] Update findings with vulnerability details
2. [ ] Capture screenshots and evidence
3. [ ] Document commands used in `/05-Tools-Output/`
4. [ ] Update credentials in `Credentials-Summary.md`
5. [ ] Update attack chain progress

### Finding Documentation Checklist

For each vulnerability found:

- [ ] Create finding file: `02-Technical-Findings/FINDING-XXX-[Title].md`
- [ ] Complete all sections (Description, Root Cause, Impact, PoC, Remediation)
- [ ] Add CVSS score and CWE reference
- [ ] Collect and reference evidence
- [ ] Link to attack phase document

### Phase Completion

After each phase:

- [ ] Document in corresponding phase file (`03-Attack-Chains/Phase-X.md`)
- [ ] Update attack chain overview
- [ ] Record credentials obtained
- [ ] Note persistence mechanisms
- [ ] Document next phase objectives

---

## Before Report Generation

### Pre-Report Checklist

1. **Findings Completeness**
   - [ ] All findings formally documented
   - [ ] CVSS scores assigned to all findings
   - [ ] CWE references included
   - [ ] Evidence collected and linked
   - [ ] PoC steps tested and verified

2. **Evidence Organization**
   - [ ] Screenshots named and indexed
   - [ ] Command output captured
   - [ ] Logs collected and stored
   - [ ] All evidence referenced in findings

3. **Attack Chain Documentation**
   - [ ] All 5 phases documented
   - [ ] Dependencies between findings clear
   - [ ] Timeline recorded
   - [ ] Alternative paths noted

4. **Credentials Tracking**
   - [ ] All credentials documented
   - [ ] Compromise method recorded
   - [ ] Risk level assessed
   - [ ] Remediation needs identified

5. **Final Review**
   - [ ] Executive report complete
   - [ ] All findings cross-referenced
   - [ ] Remediation plan clear and actionable
   - [ ] Timeline realistic
   - [ ] Sign-off page ready

---

## Report Structure Summary

```
01-Executive-Report.md
  - Executive summary
  - Scope & methodology
  - Findings overview
  - Attack chain summary
  - Remediation plan

02-Technical-Findings/
  - FINDING-001.md
  - FINDING-002.md
  - [All vulnerabilities]

03-Attack-Chains/
  - Phase-1-External-Access.md
  - Phase-2-Internal-Foothold.md
  - Phase-3-Privilege-Escalation.md
  - Phase-4-Lateral-Movement.md
  - Phase-5-Domain-Compromise.md

04-Evidence/
  - screenshots/
  - command-output/
  - logs/

05-Tools-Output/
  - nmap/
  - gobuster/
  - [Other tools]

06-Flags/
  - Flag tracking

Credentials-Summary.md
  - All credentials tracked
```

---

## Key Templates to Use

### For Each Finding

Use: `02-Technical-Findings/TEMPLATE-Finding-Format.md`

Fill in:
1. Title and severity
2. Description
3. Root cause
4. Impact (CIA triad)
5. PoC steps
6. Evidence references
7. Remediation (immediate/short/long-term)

### For Each Phase

Use: `03-Attack-Chains/Phase-X-[Name].md`

Fill in:
1. Objectives
2. High-level steps
3. Detailed walkthrough
4. Commands executed
5. Results achieved
6. Next phase link

---

## Tips for Success

1. **Document as you go** - Don't wait until the end
2. **Be specific** - Use exact hostnames, IPs, usernames
3. **Show your work** - Include commands and output
4. **Use evidence** - Link to screenshots and logs
5. **Think about impact** - Always explain why this matters
6. **Be actionable** - Provide specific remediation steps
7. **Maintain timeline** - Note when things were discovered/exploited

---

## Common Mistakes to Avoid

- ❌ Mixing raw walkthrough with formal findings
- ❌ Missing CVSS scores or CWE references
- ❌ Generic remediation ("patch the system")
- ❌ Not linking evidence to findings
- ❌ Unclear attack chain dependencies
- ❌ Missing owner/timeline in remediation
- ❌ Not verifying PoC steps before documenting

---

## Quick Commands Reference

```bash
# Find all findings
find 02-Technical-Findings -name "FINDING-*.md" | wc -l

# Check for template placeholders
grep -r "TODO\|FIXME\|\[ADD\|\[INSERT" 01-Executive-Report.md

# List all evidence
find 04-Evidence -type f | sort

# View credentials summary
cat Credentials-Summary.md
```

QUICKSTART_EOF

    echo "  Created: Quick start guide"
}

# --- Main Execution ---
echo "=========================================="
echo "Professional HTB CPTS Penetration Test Setup"
echo "=========================================="
echo ""
echo "Project: ${PROJECT_NAME}"
echo "Client: ${CLIENT_NAME}"
echo ""

create_directories
create_executive_report
create_finding_template
create_attack_chain_templates
create_evidence_structure
create_credentials_tracking
create_quick_reference

echo ""
echo "=========================================="
echo "Setup complete!"
echo "=========================================="
echo ""
echo "Project structure created at: ${PROJECT_NAME}/"
echo ""
echo "Directory Structure:"
echo "  ${PROJECT_NAME}/"
echo "  ├── 00-QUICK-START.md (Read this first!)"
echo "  ├── 01-Executive-Report.md (Main report - HTB CPTS format)"
echo "  ├── Credentials-Summary.md (All credentials tracked)"
echo "  ├── 02-Technical-Findings/ (Individual finding documentation)"
echo "  │   └── TEMPLATE-Finding-Format.md (Use for each finding)"
echo "  ├── 03-Attack-Chains/ (Phase-by-phase attack documentation)"
echo "  │   ├── Phase-1-External-Access.md"
echo "  │   ├── Phase-2-Internal-Foothold.md"
echo "  │   ├── Phase-3-Privilege-Escalation.md"
echo "  │   ├── Phase-4-Lateral-Movement.md"
echo "  │   └── Phase-5-Domain-Compromise.md"
echo "  ├── 04-Evidence/ (Organized proof-of-concept)"
echo "  │   ├── screenshots/"
echo "  │   ├── command-output/"
echo "  │   └── logs/"
echo "  ├── 05-Tools-Output/ (Raw tool outputs)"
echo "  │   └── nmap/, gobuster/, etc."
echo "  └── 06-Flags/ (HTB lab flags tracking)"
echo ""
echo "Next Steps:"
echo "  1. Read: 00-QUICK-START.md"
echo "  2. Update: 01-Executive-Report.md with client details"
echo "  3. Document: Each finding in 02-Technical-Findings/"
echo "  4. Track: All credentials in Credentials-Summary.md"
echo "  5. Detail: Attack chains in 03-Attack-Chains/"
echo "  6. Organize: Evidence in 04-Evidence/"
echo ""
echo "For HTB Labs/CPTS Exam:"
echo "  - Use Phase files to track attack progression"
echo "  - Document all findings as you discover them"
echo "  - Capture flags in 06-Flags/"
echo "  - Final report ready for submission"
echo ""
echo "For Real-World Engagements:"
echo "  - Professional report ready for client delivery"
echo "  - All findings formally documented"
echo "  - CVSS scores and remediation included"
echo "  - Attack chain demonstrates impact"
echo ""
